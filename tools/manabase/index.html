<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mana Base Calculator | ScrollVault</title>
    <meta name="description" content="Calculate the optimal mana base for your Magic: The Gathering deck. Uses Frank Karsten's math and hypergeometric probability to recommend land counts per color.">
    <meta property="og:site_name" content="ScrollVault">
    <meta property="og:title" content="Mana Base Calculator | ScrollVault">
    <meta property="og:description" content="Calculate the optimal mana base for your MTG deck using hypergeometric probability and Frank Karsten's proven math.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://scrollvault.net/tools/manabase/">
    <link rel="canonical" href="https://scrollvault.net/tools/manabase/">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1CV3DS33WK"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-1CV3DS33WK');</script>
<style>
/* ── Theme Variables ── */
:root {
    --bg-dark: #0f0f0f;
    --card-bg: #1a1a1a;
    --card-border: rgba(255,255,255,0.08);
    --card-hover-glow: rgba(139,92,246,0.25);
    --text-primary: #ffffff;
    --text-secondary: #a1a1aa;
    --text-muted: #71717a;
    --nav-bg: rgba(15,15,15,0.95);
    --nav-border: rgba(255,255,255,0.06);
    --gradient-purple: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.4);
    --shadow-lg: 0 10px 15px rgba(0,0,0,0.5);
    --color-W: #F9FAF4;
    --color-U: #0E68AB;
    --color-B: #150B00;
    --color-R: #D3202A;
    --color-G: #00733E;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-dark); color: var(--text-primary); line-height: 1.6; min-height: 100vh; }
h1,h2,h3,h4,h5,h6 { font-family: 'Space Grotesk', -apple-system, sans-serif; font-weight: 600; line-height: 1.3; }
a { color: inherit; text-decoration: none; transition: color 0.2s ease; }
a:hover { color: #a78bfa; }
.container { max-width: 1280px; margin: 0 auto; padding: 0 1rem; }

/* ── Nav ── */
.nav { position: fixed; top: 0; left: 0; right: 0; background: var(--nav-bg); backdrop-filter: blur(10px); border-bottom: 1px solid var(--nav-border); z-index: 1000; height: 64px; display: flex; align-items: center; }
.nav-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }
.nav-logo { font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; font-weight: 700; background: var(--gradient-purple); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.nav-links { display: flex; gap: 2rem; list-style: none; }
.nav-links a { font-size: 0.9rem; font-weight: 500; color: var(--text-secondary); }
.nav-links a:hover, .nav-links a.active { color: var(--text-primary); }
.mobile-menu-btn { display: none; background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer; }
@media (max-width: 768px) {
    .nav-links { display: none; position: absolute; top: 64px; left: 0; right: 0; background: var(--nav-bg); border-bottom: 1px solid var(--nav-border); flex-direction: column; padding: 1rem; gap: 0; }
    .nav-links.active { display: flex; }
    .nav-links a { padding: 0.75rem 1rem; display: block; border-bottom: 1px solid var(--card-border); }
    .nav-links a:last-child { border-bottom: none; }
    .mobile-menu-btn { display: block; }
}

/* ── Footer ── */
footer { border-top: 1px solid var(--card-border); padding: 2rem 0; margin-top: 4rem; }
.footer-content { display: flex; flex-direction: column; align-items: center; gap: 1rem; text-align: center; }
.footer-logo { font-family: 'Space Grotesk', sans-serif; font-size: 1.25rem; font-weight: 700; background: var(--gradient-purple); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.footer-text { color: var(--text-muted); font-size: 0.875rem; }
.footer-links { display: flex; gap: 1.5rem; list-style: none; }
.footer-links a { color: var(--text-secondary); font-size: 0.875rem; }
.footer-links a:hover { color: var(--text-primary); }
.wubrg-dots { display: flex; gap: 0.5rem; justify-content: center; margin-top: 0.25rem; }
.mana-dot { width: 10px; height: 10px; border-radius: 50%; }

/* ── Main ── */
main { margin-top: 64px; min-height: calc(100vh - 64px); padding-bottom: 2rem; }

/* ── Breadcrumb ── */
.breadcrumb { padding: 1.25rem 0 0; font-size: 0.85rem; color: var(--text-muted); }
.breadcrumb a { color: var(--text-secondary); }
.breadcrumb a:hover { color: #a78bfa; }
.breadcrumb span { margin: 0 0.4rem; }

/* ── Hero ── */
.hero-section { padding: 2rem 0 2.5rem; text-align: center; }
.hero-section h1 { font-size: 2.5rem; margin-bottom: 0.5rem; background: var(--gradient-purple); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.hero-section .subtitle { color: var(--text-secondary); font-size: 1.05rem; max-width: 640px; margin: 0 auto; }

/* ── Calculator Layout ── */
.calc-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
@media (max-width: 960px) {
    .calc-layout { grid-template-columns: 1fr; }
}

/* ── Panels ── */
.panel { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; padding: 1.5rem; }
.panel h2 { font-size: 1.15rem; margin-bottom: 1.25rem; display: flex; align-items: center; gap: 0.5rem; }
.panel h2 .icon { font-size: 1.1rem; }
.panel h3 { font-size: 0.95rem; margin-bottom: 0.75rem; color: var(--text-secondary); }

/* ── Format Selector ── */
.format-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 0.5rem; margin-bottom: 1.5rem; }
.format-btn { padding: 0.5rem 0.75rem; background: rgba(255,255,255,0.04); border: 1px solid var(--card-border); border-radius: 8px; font-size: 0.8rem; font-weight: 500; color: var(--text-secondary); cursor: pointer; font-family: inherit; transition: all 0.2s ease; text-align: center; }
.format-btn:hover { border-color: rgba(139,92,246,0.4); color: var(--text-primary); }
.format-btn.active { background: rgba(168,85,247,0.15); border-color: rgba(168,85,247,0.5); color: var(--text-primary); }
.format-btn .fmt-detail { display: block; font-size: 0.65rem; color: var(--text-muted); margin-top: 2px; }
.format-btn.active .fmt-detail { color: var(--text-secondary); }

/* ── Color Toggles ── */
.color-toggles { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; justify-content: center; }
.color-toggle { width: 48px; height: 48px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; font-weight: 700; font-size: 1rem; font-family: 'Space Grotesk', sans-serif; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; opacity: 0.4; position: relative; }
.color-toggle:hover { opacity: 0.7; transform: scale(1.08); }
.color-toggle.active { opacity: 1; border-color: rgba(168,85,247,0.7); transform: scale(1.1); box-shadow: 0 0 16px rgba(168,85,247,0.3); }
.color-toggle[data-color="W"] { background: var(--color-W); color: #333; }
.color-toggle[data-color="U"] { background: var(--color-U); color: #fff; }
.color-toggle[data-color="B"] { background: var(--color-B); color: #aaa; border: 3px solid rgba(255,255,255,0.15); }
.color-toggle[data-color="B"].active { border-color: rgba(168,85,247,0.7); }
.color-toggle[data-color="R"] { background: var(--color-R); color: #fff; }
.color-toggle[data-color="G"] { background: var(--color-G); color: #fff; }

/* ── Pip Inputs ── */
.pip-section { margin-bottom: 1.5rem; }
.pip-row { display: flex; align-items: center; gap: 0.75rem; padding: 0.6rem 0; border-bottom: 1px solid rgba(255,255,255,0.04); }
.pip-row:last-child { border-bottom: none; }
.pip-color-dot { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 700; flex-shrink: 0; }
.pip-label { flex: 1; font-size: 0.85rem; color: var(--text-secondary); }
.pip-controls { display: flex; align-items: center; gap: 0; }
.pip-btn { width: 32px; height: 32px; background: rgba(255,255,255,0.06); border: 1px solid var(--card-border); color: var(--text-primary); font-size: 1rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s ease; font-family: inherit; }
.pip-btn:hover { background: rgba(168,85,247,0.2); border-color: rgba(168,85,247,0.4); }
.pip-btn:first-child { border-radius: 6px 0 0 6px; }
.pip-btn:last-child { border-radius: 0 6px 6px 0; }
.pip-value { width: 40px; height: 32px; background: rgba(255,255,255,0.03); border: 1px solid var(--card-border); border-left: none; border-right: none; color: var(--text-primary); font-size: 0.9rem; font-weight: 600; text-align: center; font-family: inherit; }
.pip-value:focus { outline: none; background: rgba(168,85,247,0.1); }

/* ── Deck Size / Total Lands ── */
.size-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; }
.size-group label { display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.35rem; }
.size-group input { width: 100%; padding: 0.5rem 0.75rem; background: rgba(255,255,255,0.04); border: 1px solid var(--card-border); border-radius: 8px; color: var(--text-primary); font-size: 1rem; font-weight: 600; font-family: inherit; text-align: center; }
.size-group input:focus { outline: none; border-color: rgba(168,85,247,0.5); background: rgba(168,85,247,0.08); }

/* ── Mana Curve ── */
.curve-section { margin-bottom: 1.5rem; }
.curve-inputs { display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.4rem; }
.curve-col { text-align: center; }
.curve-col label { display: block; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 0.3rem; font-weight: 500; }
.curve-col input { width: 100%; padding: 0.4rem; background: rgba(255,255,255,0.04); border: 1px solid var(--card-border); border-radius: 6px; color: var(--text-primary); font-size: 0.85rem; font-weight: 600; text-align: center; font-family: inherit; }
.curve-col input:focus { outline: none; border-color: rgba(168,85,247,0.5); background: rgba(168,85,247,0.08); }
.curve-total { margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-muted); text-align: center; }
.curve-total strong { color: var(--text-primary); }

/* ── Calculate Button ── */
.calc-btn { display: block; width: 100%; padding: 0.85rem; background: var(--gradient-purple); border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; color: white; cursor: pointer; font-family: 'Space Grotesk', sans-serif; transition: all 0.2s ease; margin-top: 0.5rem; }
.calc-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(139,92,246,0.4); }
.calc-btn:active { transform: translateY(0); }

/* ── Results Panel ── */
.results-empty { text-align: center; padding: 3rem 1rem; color: var(--text-muted); }
.results-empty .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.3; }
.results-empty p { font-size: 0.9rem; }

/* ── Land Count Cards ── */
.land-counts { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.75rem; margin-bottom: 1.75rem; }
.land-card { background: rgba(255,255,255,0.03); border: 1px solid var(--card-border); border-radius: 10px; padding: 1rem; text-align: center; transition: all 0.2s ease; position: relative; overflow: hidden; }
.land-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
.land-card[data-color="W"]::before { background: var(--color-W); }
.land-card[data-color="U"]::before { background: var(--color-U); }
.land-card[data-color="B"]::before { background: linear-gradient(90deg, #555, #333); }
.land-card[data-color="R"]::before { background: var(--color-R); }
.land-card[data-color="G"]::before { background: var(--color-G); }
.land-card[data-color="C"]::before { background: var(--gradient-purple); }
.land-card .land-count { font-family: 'Space Grotesk', sans-serif; font-size: 2rem; font-weight: 700; }
.land-card[data-color="W"] .land-count { color: var(--color-W); }
.land-card[data-color="U"] .land-count { color: var(--color-U); }
.land-card[data-color="B"] .land-count { color: #888; }
.land-card[data-color="R"] .land-count { color: var(--color-R); }
.land-card[data-color="G"] .land-count { color: var(--color-G); }
.land-card[data-color="C"] .land-count { color: #a78bfa; }
.land-card .land-label { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.2rem; }
.land-card .land-pct { font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.15rem; }

/* ── Bar Chart ── */
.chart-section { margin-bottom: 1.75rem; }
.bar-chart { display: flex; align-items: flex-end; gap: 8px; height: 140px; padding: 0 0.5rem; }
.bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; min-width: 0; }
.bar-fill { width: 100%; border-radius: 4px 4px 0 0; transition: height 0.4s ease; min-height: 0; }
.bar-fill[data-color="W"] { background: var(--color-W); opacity: 0.85; }
.bar-fill[data-color="U"] { background: var(--color-U); }
.bar-fill[data-color="B"] { background: #555; }
.bar-fill[data-color="R"] { background: var(--color-R); }
.bar-fill[data-color="G"] { background: var(--color-G); }
.bar-fill[data-color="C"] { background: linear-gradient(180deg, #a855f7, #6366f1); }
.bar-label { font-size: 0.7rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
.bar-count { font-size: 0.7rem; color: var(--text-secondary); font-weight: 600; }

/* ── Probability Table ── */
.prob-section { margin-bottom: 1.75rem; }
.prob-table-wrapper { overflow-x: auto; }
.prob-table { width: 100%; border-collapse: collapse; font-size: 0.78rem; }
.prob-table th { padding: 0.5rem 0.6rem; text-align: center; font-weight: 600; color: var(--text-secondary); border-bottom: 2px solid var(--card-border); white-space: nowrap; background: rgba(255,255,255,0.02); }
.prob-table td { padding: 0.45rem 0.6rem; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.04); color: var(--text-secondary); font-variant-numeric: tabular-nums; }
.prob-table tr:hover td { background: rgba(168,85,247,0.05); }
.prob-table .turn-col { font-weight: 600; color: var(--text-primary); text-align: left; }
.prob-good { color: #4ade80; }
.prob-ok { color: #facc15; }
.prob-bad { color: #f87171; }

/* ── Suggested Mana Base ── */
.suggested-section { margin-bottom: 1.75rem; }
.suggest-card { background: rgba(255,255,255,0.03); border: 1px solid var(--card-border); border-radius: 8px; padding: 0.85rem 1rem; margin-bottom: 0.5rem; }
.suggest-card h4 { font-size: 0.85rem; margin-bottom: 0.35rem; color: var(--text-primary); }
.suggest-card p { font-size: 0.78rem; color: var(--text-secondary); line-height: 1.5; }
.suggest-card .suggest-lands { display: flex; flex-wrap: wrap; gap: 0.35rem; margin-top: 0.4rem; }
.suggest-land { display: inline-flex; align-items: center; gap: 0.3rem; background: rgba(168,85,247,0.1); border: 1px solid rgba(168,85,247,0.2); border-radius: 5px; padding: 0.2rem 0.5rem; font-size: 0.72rem; color: var(--text-secondary); }
.suggest-land .sl-count { font-weight: 700; color: var(--text-primary); }

/* ── Info Box ── */
.info-box { background: rgba(168,85,247,0.08); border: 1px solid rgba(168,85,247,0.2); border-radius: 10px; padding: 1.25rem; margin-top: 1.5rem; }
.info-box h3 { font-size: 0.95rem; margin-bottom: 0.5rem; color: #a78bfa; display: flex; align-items: center; gap: 0.4rem; }
.info-box p { font-size: 0.82rem; color: var(--text-secondary); line-height: 1.65; }
.info-box a { color: #a78bfa; text-decoration: underline; }
.info-box a:hover { color: #c4b5fd; }

/* ── Responsive ── */
@media (max-width: 640px) {
    .hero-section h1 { font-size: 1.75rem; }
    .color-toggles { gap: 0.5rem; }
    .color-toggle { width: 40px; height: 40px; font-size: 0.85rem; }
    .curve-inputs { grid-template-columns: repeat(4, 1fr); }
    .land-counts { grid-template-columns: repeat(2, 1fr); }
    .format-grid { grid-template-columns: repeat(3, 1fr); }
    .size-inputs { grid-template-columns: 1fr; }
}
    </style>
</head>
<body>
    <nav class="nav">
        <div class="container nav-content">
            <a href="/" class="nav-logo">ScrollVault</a>
            <button class="mobile-menu-btn" onclick="document.getElementById('navLinks').classList.toggle('active')">&#9776;</button>
            <ul class="nav-links" id="navLinks">
                <li><a href="/">Home</a></li>
                <li><a href="/news/">News</a></li>
                <li><a href="/guides/">Guides</a></li>
                <li><a href="/decks/">Top Decks</a></li>
                <li><a href="/draft/">Draft</a></li>
                <li><a href="/tools/lands/">Lands</a></li>
                <li><a href="/tools/manabase/" class="active">Mana Base</a></li>
                <li><a href="/about.html">About</a></li>
                <li><a href="/contact.html">Contact</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="container">
            <div class="breadcrumb">
                <a href="/">Home</a><span>/</span>
                <a href="/tools/lands/">Tools</a><span>/</span>
                Mana Base Calculator
            </div>

            <div class="hero-section">
                <h1>Mana Base Calculator</h1>
                <p class="subtitle">Build a mathematically optimal mana base for your deck. Powered by hypergeometric probability and Frank Karsten's research.</p>
            </div>

            <div class="calc-layout">
                <!-- ═══ LEFT: Input Panel ═══ -->
                <div class="panel" id="inputPanel">
                    <h2><span class="icon">&#9881;</span> Deck Configuration</h2>

                    <!-- Format Selector -->
                    <h3>Format</h3>
                    <div class="format-grid" id="formatGrid">
                        <button class="format-btn active" data-format="standard" data-deck="60" data-lands="24">
                            Standard
                            <span class="fmt-detail">60 / 24 lands</span>
                        </button>
                        <button class="format-btn" data-format="modern" data-deck="60" data-lands="23">
                            Modern
                            <span class="fmt-detail">60 / 23 lands</span>
                        </button>
                        <button class="format-btn" data-format="pioneer" data-deck="60" data-lands="24">
                            Pioneer
                            <span class="fmt-detail">60 / 24 lands</span>
                        </button>
                        <button class="format-btn" data-format="legacy" data-deck="60" data-lands="22">
                            Legacy
                            <span class="fmt-detail">60 / 22 lands</span>
                        </button>
                        <button class="format-btn" data-format="limited" data-deck="40" data-lands="17">
                            Limited
                            <span class="fmt-detail">40 / 17 lands</span>
                        </button>
                        <button class="format-btn" data-format="commander" data-deck="100" data-lands="37">
                            Commander
                            <span class="fmt-detail">100 / 37 lands</span>
                        </button>
                        <button class="format-btn" data-format="custom">
                            Custom
                            <span class="fmt-detail">Set your own</span>
                        </button>
                    </div>

                    <!-- Deck Size / Land Count -->
                    <div class="size-inputs">
                        <div class="size-group">
                            <label for="deckSize">Deck Size</label>
                            <input type="number" id="deckSize" value="60" min="20" max="250">
                        </div>
                        <div class="size-group">
                            <label for="totalLands">Total Lands</label>
                            <input type="number" id="totalLands" value="24" min="0" max="120">
                        </div>
                    </div>

                    <!-- Color Toggles -->
                    <h3>Colors</h3>
                    <div class="color-toggles" id="colorToggles">
                        <button class="color-toggle active" data-color="W" title="White">W</button>
                        <button class="color-toggle active" data-color="U" title="Blue">U</button>
                        <button class="color-toggle" data-color="B" title="Black">B</button>
                        <button class="color-toggle" data-color="R" title="Red">R</button>
                        <button class="color-toggle" data-color="G" title="Green">G</button>
                    </div>

                    <!-- Pip Inputs -->
                    <h3>Colored Mana Pips</h3>
                    <div class="pip-section" id="pipSection">
                        <!-- Populated by JS -->
                    </div>

                    <!-- Mana Curve -->
                    <div class="curve-section">
                        <h3>Mana Curve (Number of Spells)</h3>
                        <div class="curve-inputs" id="curveInputs">
                            <div class="curve-col">
                                <label>0 MV</label>
                                <input type="number" min="0" max="60" value="0" data-mv="0">
                            </div>
                            <div class="curve-col">
                                <label>1 MV</label>
                                <input type="number" min="0" max="60" value="8" data-mv="1">
                            </div>
                            <div class="curve-col">
                                <label>2 MV</label>
                                <input type="number" min="0" max="60" value="10" data-mv="2">
                            </div>
                            <div class="curve-col">
                                <label>3 MV</label>
                                <input type="number" min="0" max="60" value="8" data-mv="3">
                            </div>
                            <div class="curve-col">
                                <label>4 MV</label>
                                <input type="number" min="0" max="60" value="6" data-mv="4">
                            </div>
                            <div class="curve-col">
                                <label>5 MV</label>
                                <input type="number" min="0" max="60" value="3" data-mv="5">
                            </div>
                            <div class="curve-col">
                                <label>6 MV</label>
                                <input type="number" min="0" max="60" value="1" data-mv="6">
                            </div>
                            <div class="curve-col">
                                <label>7+</label>
                                <input type="number" min="0" max="60" value="0" data-mv="7">
                            </div>
                        </div>
                        <div class="curve-total" id="curveTotal">Spells: <strong>36</strong> / Lands: <strong>24</strong> / Total: <strong>60</strong></div>
                    </div>

                    <button class="calc-btn" id="calcBtn" onclick="calculate()">Calculate Mana Base</button>
                </div>

                <!-- ═══ RIGHT: Results Panel ═══ -->
                <div class="panel" id="resultsPanel">
                    <h2><span class="icon">&#9733;</span> Results</h2>

                    <div id="resultsContent">
                        <div class="results-empty">
                            <div class="empty-icon">&#127183;</div>
                            <p>Select your colors and configure your deck, then click <strong>Calculate Mana Base</strong> to see results.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>&#128218; About the Math</h3>
                <p>
                    This calculator is based on <strong>Frank Karsten's</strong> seminal research on mana bases in Magic: The Gathering,
                    originally published in his ChannelFireball article
                    <a href="https://strategy.channelfireball.com/all-strategy/mtg/channelmagic-articles/how-many-colored-mana-sources-do-you-need-to-consistently-cast-your-spells-a-guilds-of-ravnica-update/" target="_blank" rel="noopener">"How Many Colored Mana Sources Do You Need to Consistently Cast Your Spells?"</a>.
                    The core idea: for each colored mana symbol in your deck's casting costs, you need a certain number of
                    lands that produce that color. The probability calculations use the <strong>hypergeometric distribution</strong>
                    to determine the likelihood of drawing enough colored sources by the turn you need to cast each spell.
                    This implementation uses <code>logChoose</code> (log of binomial coefficients) for numerical stability
                    with large deck sizes like Commander. The recommended land counts aim for approximately a 90% chance of
                    having the required colors on curve.
                </p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">ScrollVault</div>
                <div class="wubrg-dots">
                    <span class="mana-dot" style="background: #F9FAF4"></span>
                    <span class="mana-dot" style="background: #0E68AB"></span>
                    <span class="mana-dot" style="background: #150B00; border: 1px solid rgba(255,255,255,0.2)"></span>
                    <span class="mana-dot" style="background: #D3202A"></span>
                    <span class="mana-dot" style="background: #00733E"></span>
                </div>
                <p class="footer-text">&copy; 2026 scrollvault.net. Magic: The Gathering is a trademark of Wizards of the Coast. Card images &copy; Wizards of the Coast via Scryfall.</p>
                <ul class="footer-links">
                    <li><a href="/privacy.html">Privacy Policy</a></li>
                    <li><a href="/terms.html">Terms of Service</a></li>
                    <li><a href="/contact.html">Contact</a></li>
                    <li><a href="/about/authors.html">Authors</a></li>
                    <li><a href="/about/editorial-policy.html">Editorial Policy</a></li>
                </ul>
            </div>
        </div>
    </footer>

<script>
/* ══════════════════════════════════════════
   Mana Base Calculator - ScrollVault
   ══════════════════════════════════════════ */

// ── State ──
const COLORS = ['W', 'U', 'B', 'R', 'G'];
const COLOR_NAMES = { W: 'White', U: 'Blue', B: 'Black', R: 'Red', G: 'Green' };
const COLOR_HEX = { W: '#F9FAF4', U: '#0E68AB', B: '#555', R: '#D3202A', G: '#00733E' };
const COLOR_TEXT = { W: '#333', U: '#fff', B: '#ccc', R: '#fff', G: '#fff' };

let state = {
    format: 'standard',
    deckSize: 60,
    totalLands: 24,
    activeColors: new Set(['W', 'U']),
    pips: { W: 12, U: 12, B: 0, R: 0, G: 0 },
    curve: [0, 8, 10, 8, 6, 3, 1, 0]
};

// ── Format Presets ──
const FORMAT_DUALS = {
    standard: {
        label: 'Standard',
        duals: ['Shock Lands'],
        hasFetches: false
    },
    pioneer: {
        label: 'Pioneer',
        duals: ['Shock Lands', 'Fetch Lands'],
        hasFetches: true
    },
    modern: {
        label: 'Modern',
        duals: ['Shock Lands', 'Fetch Lands', 'Fast Lands'],
        hasFetches: true
    },
    legacy: {
        label: 'Legacy',
        duals: ['Shock Lands', 'Fetch Lands', 'Original Duals', 'Fast Lands', 'Check Lands', 'Pain Lands'],
        hasFetches: true
    },
    limited: {
        label: 'Limited',
        duals: ['Gates', 'Gain Lands', 'Taplands (as drafted)'],
        hasFetches: false
    },
    commander: {
        label: 'Commander',
        duals: ['Shock Lands', 'Fetch Lands', 'Original Duals', 'Triomes', 'Command Tower', 'Exotic Orchard'],
        hasFetches: true
    },
    custom: {
        label: 'Custom',
        duals: ['Any dual lands available in your format'],
        hasFetches: false
    }
};

// ── Dual Land Names by Color Pair ──
const DUAL_NAMES = {
    WU: { shock: 'Hallowed Fountain', fetch: 'Flooded Strand', original: 'Tundra', fast: 'Seachrome Coast', check: 'Glacial Fortress', pain: 'Adarkar Wastes' },
    WB: { shock: 'Godless Shrine', fetch: 'Marsh Flats', original: 'Scrubland', fast: 'Concealed Courtyard', check: 'Isolated Chapel', pain: 'Caves of Koilos' },
    WR: { shock: 'Sacred Foundry', fetch: 'Arid Mesa', original: 'Plateau', fast: 'Inspiring Vantage', check: 'Clifftop Retreat', pain: 'Battlefield Forge' },
    WG: { shock: 'Temple Garden', fetch: 'Windswept Heath', original: 'Savannah', fast: 'Botanical Sanctum', check: 'Sunpetal Grove', pain: 'Brushland' },
    UB: { shock: 'Watery Grave', fetch: 'Polluted Delta', original: 'Underground Sea', fast: 'Darkslick Shores', check: 'Drowned Catacomb', pain: 'Underground River' },
    UR: { shock: 'Steam Vents', fetch: 'Scalding Tarn', original: 'Volcanic Island', fast: 'Spirebluff Canal', check: 'Sulfur Falls', pain: 'Shivan Reef' },
    UG: { shock: 'Breeding Pool', fetch: 'Misty Rainforest', original: 'Tropical Island', fast: '', check: 'Hinterland Harbor', pain: 'Yavimaya Coast' },
    BR: { shock: 'Blood Crypt', fetch: 'Bloodstained Mire', original: 'Badlands', fast: 'Blackcleave Cliffs', check: 'Dragonskull Summit', pain: 'Sulfurous Springs' },
    BG: { shock: 'Overgrown Tomb', fetch: 'Verdant Catacombs', original: 'Bayou', fast: 'Blooming Marsh', check: 'Woodland Cemetery', pain: 'Llanowar Wastes' },
    RG: { shock: 'Stomping Ground', fetch: 'Wooded Foothills', original: 'Taiga', fast: 'Copperline Gorge', check: 'Rootbound Crag', pain: 'Karplusan Forest' }
};

// ══════════════════════════════════════════
// Hypergeometric Probability (logChoose)
// ══════════════════════════════════════════

function logFactorial(n) {
    // Stirling's approximation for large n, exact for small n
    if (n < 0) return 0;
    if (n <= 1) return 0;
    if (n < 20) {
        let result = 0;
        for (let i = 2; i <= n; i++) result += Math.log(i);
        return result;
    }
    // Stirling's approximation
    return n * Math.log(n) - n + 0.5 * Math.log(2 * Math.PI * n) + 1/(12*n) - 1/(360*n*n*n);
}

function logChoose(n, k) {
    if (k < 0 || k > n) return -Infinity;
    if (k === 0 || k === n) return 0;
    return logFactorial(n) - logFactorial(k) - logFactorial(n - k);
}

function hypergeometricPMF(x, N, K, n) {
    // P(X = x) where:
    // N = population size (deck size)
    // K = successes in population (colored sources)
    // n = draws (cards drawn by turn)
    // x = successes in draws (colored sources drawn)
    if (x < 0 || x > Math.min(K, n) || x < Math.max(0, n - (N - K))) return 0;
    var logP = logChoose(K, x) + logChoose(N - K, n - x) - logChoose(N, n);
    return Math.exp(logP);
}

function hypergeometricCDF_atLeast(k, N, K, n) {
    // P(X >= k): probability of drawing at least k successes
    if (k <= 0) return 1;
    if (k > Math.min(K, n)) return 0;
    // Sum P(X = i) for i from k to min(K, n)
    var maxX = Math.min(K, n);
    var sum = 0;
    for (var i = k; i <= maxX; i++) {
        sum += hypergeometricPMF(i, N, K, n);
    }
    return Math.min(1, Math.max(0, sum));
}

// ══════════════════════════════════════════
// Karsten's land recommendation
// ══════════════════════════════════════════

// Given the number of pips in a color, return recommended colored sources
// Based on Karsten's table (for 60-card, 7 card opening hand + draws)
function karstenSourcesFor60(pips) {
    // Approximate Karsten's recommendations
    var table = {
        1: 2, 2: 4, 3: 5, 4: 7, 5: 8, 6: 9, 7: 10, 8: 11, 9: 12,
        10: 13, 11: 13, 12: 14, 13: 14, 14: 15, 15: 15, 16: 16,
        17: 16, 18: 17, 19: 17, 20: 18
    };
    if (pips <= 0) return 0;
    if (pips >= 20) return 18;
    return table[pips] || Math.min(Math.round(pips * 0.9 + 1), 20);
}

function recommendedSources(pips, deckSize, totalLands) {
    // Scale Karsten's 60-card recommendations to other deck sizes
    if (pips <= 0) return 0;
    var base60 = karstenSourcesFor60(pips);
    // Scale proportionally
    var scaleFactor = deckSize / 60;
    var landFactor = totalLands / 24;
    // Weighted scale
    var scaled = base60 * ((scaleFactor + landFactor) / 2);
    return Math.max(1, Math.round(scaled));
}

// ══════════════════════════════════════════
// UI Initialization
// ══════════════════════════════════════════

function init() {
    setupFormatButtons();
    setupColorToggles();
    renderPipInputs();
    setupCurveListeners();
    updateCurveTotal();
}

function setupFormatButtons() {
    var btns = document.querySelectorAll('.format-btn');
    btns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            btns.forEach(function(b) { b.classList.remove('active'); });
            btn.classList.add('active');
            state.format = btn.dataset.format;
            if (btn.dataset.format !== 'custom') {
                var ds = parseInt(btn.dataset.deck);
                var tl = parseInt(btn.dataset.lands);
                state.deckSize = ds;
                state.totalLands = tl;
                document.getElementById('deckSize').value = ds;
                document.getElementById('totalLands').value = tl;
                updateCurveTotal();
            }
        });
    });
}

function setupColorToggles() {
    var toggles = document.querySelectorAll('.color-toggle');
    toggles.forEach(function(t) {
        t.addEventListener('click', function() {
            var c = t.dataset.color;
            if (state.activeColors.has(c)) {
                state.activeColors.delete(c);
                t.classList.remove('active');
            } else {
                state.activeColors.add(c);
                t.classList.add('active');
            }
            renderPipInputs();
        });
    });
}

function renderPipInputs() {
    var section = document.getElementById('pipSection');
    section.innerHTML = '';
    if (state.activeColors.size === 0) {
        section.innerHTML = '<p style="color:var(--text-muted);font-size:0.85rem;text-align:center;padding:1rem 0;">Select at least one color above.</p>';
        return;
    }
    COLORS.forEach(function(c) {
        if (!state.activeColors.has(c)) {
            state.pips[c] = 0;
            return;
        }
        var row = document.createElement('div');
        row.className = 'pip-row';

        var dot = document.createElement('div');
        dot.className = 'pip-color-dot';
        dot.style.background = COLOR_HEX[c];
        if (c === 'B') dot.style.border = '1px solid rgba(255,255,255,0.2)';
        dot.style.color = COLOR_TEXT[c];
        dot.textContent = c;

        var label = document.createElement('div');
        label.className = 'pip-label';
        label.textContent = COLOR_NAMES[c] + ' pips';

        var controls = document.createElement('div');
        controls.className = 'pip-controls';

        var minBtn = document.createElement('button');
        minBtn.className = 'pip-btn';
        minBtn.textContent = '-';
        minBtn.setAttribute('data-color', c);
        minBtn.setAttribute('data-dir', '-1');
        minBtn.addEventListener('click', function() { adjustPip(c, -1); });

        var val = document.createElement('input');
        val.className = 'pip-value';
        val.type = 'number';
        val.min = '0';
        val.max = '99';
        val.value = state.pips[c];
        val.id = 'pip-' + c;
        val.addEventListener('change', function() {
            state.pips[c] = Math.max(0, parseInt(val.value) || 0);
        });

        var plusBtn = document.createElement('button');
        plusBtn.className = 'pip-btn';
        plusBtn.textContent = '+';
        plusBtn.addEventListener('click', function() { adjustPip(c, 1); });

        controls.appendChild(minBtn);
        controls.appendChild(val);
        controls.appendChild(plusBtn);

        row.appendChild(dot);
        row.appendChild(label);
        row.appendChild(controls);
        section.appendChild(row);
    });
}

function adjustPip(color, delta) {
    var input = document.getElementById('pip-' + color);
    var val = Math.max(0, (parseInt(input.value) || 0) + delta);
    input.value = val;
    state.pips[color] = val;
}

function setupCurveListeners() {
    var inputs = document.querySelectorAll('#curveInputs input');
    inputs.forEach(function(inp) {
        inp.addEventListener('input', function() {
            var mv = parseInt(inp.dataset.mv);
            state.curve[mv] = Math.max(0, parseInt(inp.value) || 0);
            updateCurveTotal();
        });
    });

    document.getElementById('deckSize').addEventListener('input', function() {
        state.deckSize = Math.max(20, parseInt(this.value) || 60);
        // Switch to custom format
        selectCustomFormat();
        updateCurveTotal();
    });

    document.getElementById('totalLands').addEventListener('input', function() {
        state.totalLands = Math.max(0, parseInt(this.value) || 0);
        selectCustomFormat();
        updateCurveTotal();
    });
}

function selectCustomFormat() {
    var btns = document.querySelectorAll('.format-btn');
    var isPreset = false;
    btns.forEach(function(b) {
        if (b.dataset.format !== 'custom' && parseInt(b.dataset.deck) === state.deckSize && parseInt(b.dataset.lands) === state.totalLands) {
            isPreset = true;
        }
    });
    if (!isPreset) {
        btns.forEach(function(b) { b.classList.remove('active'); });
        document.querySelector('.format-btn[data-format="custom"]').classList.add('active');
        state.format = 'custom';
    }
}

function updateCurveTotal() {
    var spells = state.curve.reduce(function(a, b) { return a + b; }, 0);
    var total = spells + state.totalLands;
    var el = document.getElementById('curveTotal');
    var mismatch = total !== state.deckSize;
    el.innerHTML = 'Spells: <strong>' + spells + '</strong> / Lands: <strong>' + state.totalLands + '</strong> / Total: <strong' + (mismatch ? ' style="color:#f87171"' : '') + '>' + total + '</strong>' + (mismatch ? ' <span style="color:#f87171;font-size:0.75rem;">(expected ' + state.deckSize + ')</span>' : '');
}

// ══════════════════════════════════════════
// Calculation
// ══════════════════════════════════════════

function calculate() {
    // Read latest state
    state.deckSize = Math.max(20, parseInt(document.getElementById('deckSize').value) || 60);
    state.totalLands = Math.max(0, parseInt(document.getElementById('totalLands').value) || 0);
    COLORS.forEach(function(c) {
        var inp = document.getElementById('pip-' + c);
        if (inp) state.pips[c] = Math.max(0, parseInt(inp.value) || 0);
    });

    var activeList = COLORS.filter(function(c) { return state.activeColors.has(c) && state.pips[c] > 0; });

    if (activeList.length === 0) {
        showEmptyResults('Select at least one color and enter mana pips to calculate.');
        return;
    }

    // Calculate recommended sources per color
    var recommended = {};
    var totalRecommended = 0;
    activeList.forEach(function(c) {
        recommended[c] = recommendedSources(state.pips[c], state.deckSize, state.totalLands);
        totalRecommended += recommended[c];
    });

    // If total recommended > total lands, scale down proportionally
    if (totalRecommended > state.totalLands && totalRecommended > 0) {
        var scale = state.totalLands / totalRecommended;
        activeList.forEach(function(c) {
            recommended[c] = Math.max(1, Math.round(recommended[c] * scale));
        });
        // Adjust rounding to match exactly
        var newTotal = 0;
        activeList.forEach(function(c) { newTotal += recommended[c]; });
        var diff = state.totalLands - newTotal;
        // Distribute remainder to colors with most pips
        var sorted = activeList.slice().sort(function(a, b) { return state.pips[b] - state.pips[a]; });
        var i = 0;
        while (diff > 0 && i < sorted.length) { recommended[sorted[i]]++; diff--; i++; }
        while (diff < 0 && i < sorted.length) {
            if (recommended[sorted[i]] > 1) { recommended[sorted[i]]--; diff++; }
            i++;
        }
    }

    // If total recommended < total lands, remaining are colorless/utility
    var colorlessLands = Math.max(0, state.totalLands - activeList.reduce(function(s, c) { return s + recommended[c]; }, 0));

    // Build results HTML
    var html = '';

    // ── Land Count Cards ──
    html += '<h3>Recommended Land Sources</h3>';
    html += '<div class="land-counts">';
    activeList.forEach(function(c) {
        var pct = state.totalLands > 0 ? Math.round((recommended[c] / state.totalLands) * 100) : 0;
        html += '<div class="land-card" data-color="' + c + '">';
        html += '<div class="land-count">' + recommended[c] + '</div>';
        html += '<div class="land-label">' + COLOR_NAMES[c] + ' Sources</div>';
        html += '<div class="land-pct">' + pct + '% of lands</div>';
        html += '</div>';
    });
    if (colorlessLands > 0) {
        var pct = Math.round((colorlessLands / state.totalLands) * 100);
        html += '<div class="land-card" data-color="C">';
        html += '<div class="land-count">' + colorlessLands + '</div>';
        html += '<div class="land-label">Colorless / Utility</div>';
        html += '<div class="land-pct">' + pct + '% of lands</div>';
        html += '</div>';
    }
    html += '</div>';

    // ── Bar Chart ──
    html += '<div class="chart-section">';
    html += '<h3>Land Distribution</h3>';
    html += '<div class="bar-chart">';
    var maxCount = 0;
    activeList.forEach(function(c) { if (recommended[c] > maxCount) maxCount = recommended[c]; });
    if (colorlessLands > maxCount) maxCount = colorlessLands;
    if (maxCount === 0) maxCount = 1;

    activeList.forEach(function(c) {
        var h = Math.round((recommended[c] / maxCount) * 120);
        html += '<div class="bar-col">';
        html += '<div class="bar-count">' + recommended[c] + '</div>';
        html += '<div class="bar-fill" data-color="' + c + '" style="height:' + h + 'px"></div>';
        html += '<div class="bar-label">' + COLOR_NAMES[c] + '</div>';
        html += '</div>';
    });
    if (colorlessLands > 0) {
        var h = Math.round((colorlessLands / maxCount) * 120);
        html += '<div class="bar-col">';
        html += '<div class="bar-count">' + colorlessLands + '</div>';
        html += '<div class="bar-fill" data-color="C" style="height:' + h + 'px"></div>';
        html += '<div class="bar-label">Colorless</div>';
        html += '</div>';
    }
    html += '</div></div>';

    // ── Hypergeometric Probability Table ──
    html += '<div class="prob-section">';
    html += '<h3>Probability of Having Color On Time</h3>';
    html += '<p style="font-size:0.75rem;color:var(--text-muted);margin-bottom:0.75rem;">Chance of having at least the needed colored sources by each turn (opening hand = turn 1).</p>';
    html += '<div class="prob-table-wrapper"><table class="prob-table">';
    html += '<thead><tr><th>Turn</th>';
    activeList.forEach(function(c) {
        html += '<th style="color:' + COLOR_HEX[c] + '">' + COLOR_NAMES[c] + ' (' + recommended[c] + ')</th>';
    });
    html += '</tr></thead><tbody>';

    for (var turn = 1; turn <= 7; turn++) {
        var cardsDrawn = 6 + turn; // 7 opening hand + (turn-1) draws = 6+turn
        html += '<tr><td class="turn-col">Turn ' + turn + ' (' + cardsDrawn + ' cards)</td>';
        activeList.forEach(function(c) {
            // How many of this color do we need by this turn?
            // Approximate: need 1 source by turn the cheapest spell needs it,
            // scaling up. Simple approach: need ceil(pips * turn / avgCMC) but
            // use the practical approach of "need at least 1 by T1, and more later"
            var needed = neededByTurn(c, turn);
            var prob = hypergeometricCDF_atLeast(needed, state.deckSize, recommended[c], cardsDrawn);
            var pctStr = (prob * 100).toFixed(1) + '%';
            var cls = prob >= 0.9 ? 'prob-good' : (prob >= 0.7 ? 'prob-ok' : 'prob-bad');
            html += '<td class="' + cls + '">' + pctStr + '</td>';
        });
        html += '</tr>';
    }
    html += '</tbody></table></div></div>';

    // ── Suggested Mana Base ──
    html += '<div class="suggested-section">';
    html += '<h3>Suggested Mana Base</h3>';

    var fmt = FORMAT_DUALS[state.format] || FORMAT_DUALS['custom'];

    // Calculate dual land suggestions
    if (activeList.length >= 2) {
        html += buildDualSuggestions(activeList, recommended, colorlessLands, fmt);
    } else {
        // Mono color
        var c = activeList[0];
        html += '<div class="suggest-card">';
        html += '<h4>Mono-' + COLOR_NAMES[c] + '</h4>';
        html += '<p>With a single color, your mana base is straightforward. Run ' + recommended[c] + ' basic ' + basicLandName(c) + 's';
        if (colorlessLands > 0) {
            html += ' and ' + colorlessLands + ' utility lands (e.g., Castle, creature lands, or colorless utility).';
        } else {
            html += '.';
        }
        html += '</p>';
        html += '<div class="suggest-lands">';
        html += '<span class="suggest-land"><span class="sl-count">' + recommended[c] + '</span> ' + basicLandName(c) + '</span>';
        if (colorlessLands > 0) {
            html += '<span class="suggest-land"><span class="sl-count">' + colorlessLands + '</span> Utility Lands</span>';
        }
        html += '</div></div>';
    }

    html += '</div>';

    document.getElementById('resultsContent').innerHTML = html;

    // Scroll to results on mobile
    if (window.innerWidth <= 960) {
        document.getElementById('resultsPanel').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

function neededByTurn(color, turn) {
    // Estimate how many sources of this color we need by a given turn
    // Based on the curve: look at spells castable by this turn and their pip requirements
    // Simplified: assume pips scale linearly, need at least 1 by turn 1-2, and max by late game
    var totalPips = state.pips[color];
    if (totalPips <= 0) return 0;

    // Find the max pips we'd need for any single card in our curve
    // Since we don't have per-card data, approximate based on pip density
    var totalSpells = state.curve.reduce(function(a, b) { return a + b; }, 0);
    if (totalSpells === 0) return 1;

    // Karsten's approach: for a spell with N pips of a color at MV M,
    // you need N sources by turn M. Without per-card data, we estimate:
    // Turn 1: need 1 source if we have 1-pip spells
    // Turn 2: need 1 source
    // Turn 3+: scale up to meet pip density
    if (turn <= 1) return 1;
    if (turn <= 2) return Math.min(2, Math.ceil(totalPips / totalSpells * 4));

    // For later turns, estimate needed sources based on pip density
    // and what portion of the deck we'd want to cast by then
    var cumSpells = 0;
    for (var mv = 0; mv <= Math.min(turn, 7); mv++) {
        cumSpells += (state.curve[mv] || 0);
    }
    var spellFraction = totalSpells > 0 ? cumSpells / totalSpells : 0;

    // Need enough to cast our proportional share of colored spells
    var needed = Math.max(1, Math.ceil(totalPips / totalSpells * cumSpells * 0.3));
    // But never more than what the color actually demands for a single casting
    needed = Math.min(needed, Math.ceil(totalPips * 0.4));
    // At minimum 1, at maximum something reasonable
    return Math.max(1, Math.min(needed, turn));
}

function basicLandName(c) {
    var names = { W: 'Plains', U: 'Island', B: 'Swamp', R: 'Mountain', G: 'Forest' };
    return names[c] || 'Basic Land';
}

function getColorPair(c1, c2) {
    // Return canonical pair ordering (WUBRG order)
    var order = 'WUBRG';
    if (order.indexOf(c1) < order.indexOf(c2)) return c1 + c2;
    return c2 + c1;
}

function buildDualSuggestions(activeList, recommended, colorlessLands, fmt) {
    var html = '';
    var pairs = [];

    // Generate all color pairs
    for (var i = 0; i < activeList.length; i++) {
        for (var j = i + 1; j < activeList.length; j++) {
            pairs.push(getColorPair(activeList[i], activeList[j]));
        }
    }

    // Suggest dual lands for each pair
    var totalDuals = 0;
    var dualCounts = {};
    var basicsNeeded = {};

    // Initialize basics at full recommended
    activeList.forEach(function(c) { basicsNeeded[c] = recommended[c]; });

    // For each pair, suggest ~4 duals (or fewer for formats with less fixing)
    var dualsPerPair = activeList.length <= 2 ? 4 : (activeList.length <= 3 ? 3 : 2);
    if (state.format === 'limited') dualsPerPair = Math.min(2, dualsPerPair);
    if (state.format === 'commander') dualsPerPair = activeList.length <= 3 ? 3 : 2;

    pairs.forEach(function(pair) {
        var c1 = pair[0], c2 = pair[1];
        var count = dualsPerPair;
        dualCounts[pair] = count;
        totalDuals += count;
        // Each dual reduces need for basics of both colors
        basicsNeeded[c1] = Math.max(0, basicsNeeded[c1] - count);
        basicsNeeded[c2] = Math.max(0, basicsNeeded[c2] - count);
    });

    // Ensure we don't exceed total lands
    var totalBasics = 0;
    activeList.forEach(function(c) { totalBasics += basicsNeeded[c]; });
    var allocated = totalDuals + totalBasics + colorlessLands;
    if (allocated > state.totalLands) {
        // Reduce colorless first, then basics proportionally
        var excess = allocated - state.totalLands;
        var removed = Math.min(excess, colorlessLands);
        colorlessLands -= removed;
        excess -= removed;
        if (excess > 0) {
            // Reduce basics proportionally
            activeList.forEach(function(c) {
                if (excess <= 0) return;
                var cut = Math.min(Math.ceil(excess / activeList.length), basicsNeeded[c]);
                basicsNeeded[c] -= cut;
                excess -= cut;
            });
        }
    }

    // Build suggestion cards
    // Dual Lands
    html += '<div class="suggest-card">';
    html += '<h4>Dual Lands (' + fmt.label + ')</h4>';
    html += '<p>Recommended dual land slots for your color combination. Available cycles: ' + fmt.duals.join(', ') + '.</p>';
    html += '<div class="suggest-lands">';
    pairs.forEach(function(pair) {
        var dualInfo = DUAL_NAMES[pair];
        var c1 = pair[0], c2 = pair[1];
        var count = dualCounts[pair];
        var landName = '';
        if (dualInfo) {
            if (fmt.hasFetches) {
                landName = dualInfo.shock + (dualInfo.fetch ? ' / ' + dualInfo.fetch : '');
            } else if (state.format === 'standard') {
                landName = dualInfo.shock;
            } else {
                landName = COLOR_NAMES[c1] + '/' + COLOR_NAMES[c2] + ' dual';
            }
        } else {
            landName = COLOR_NAMES[c1] + '/' + COLOR_NAMES[c2] + ' dual';
        }
        html += '<span class="suggest-land"><span class="sl-count">' + count + '</span> ' + landName + '</span>';
    });
    html += '</div></div>';

    // Basic Lands
    html += '<div class="suggest-card">';
    html += '<h4>Basic Lands</h4>';
    html += '<p>Fill remaining slots with basic lands proportional to your color requirements.</p>';
    html += '<div class="suggest-lands">';
    activeList.forEach(function(c) {
        if (basicsNeeded[c] > 0) {
            html += '<span class="suggest-land"><span class="sl-count">' + basicsNeeded[c] + '</span> ' + basicLandName(c) + '</span>';
        }
    });
    if (colorlessLands > 0) {
        html += '<span class="suggest-land"><span class="sl-count">' + colorlessLands + '</span> Utility / Colorless</span>';
    }
    html += '</div></div>';

    // Triomes for 3+ color decks
    if (activeList.length >= 3 && (state.format === 'modern' || state.format === 'legacy' || state.format === 'commander')) {
        html += '<div class="suggest-card">';
        html += '<h4>Consider Triomes</h4>';
        html += '<p>With ' + activeList.length + ' colors, Triomes (3-color lands from Ikoria/Streets of New Capenna) provide excellent fixing. They are fetchable and provide three colors, at the cost of always entering tapped.</p>';
        html += '</div>';
    }

    // Commander special: Command Tower, Exotic Orchard
    if (state.format === 'commander' && activeList.length >= 2) {
        html += '<div class="suggest-card">';
        html += '<h4>Commander Staples</h4>';
        html += '<p>Don\'t forget Commander-specific lands that provide all your colors:</p>';
        html += '<div class="suggest-lands">';
        html += '<span class="suggest-land"><span class="sl-count">1</span> Command Tower</span>';
        html += '<span class="suggest-land"><span class="sl-count">1</span> Exotic Orchard</span>';
        if (activeList.length >= 3) {
            html += '<span class="suggest-land"><span class="sl-count">1</span> Chromatic Lantern (mana rock)</span>';
        }
        html += '</div></div>';
    }

    return html;
}

function showEmptyResults(msg) {
    document.getElementById('resultsContent').innerHTML = '<div class="results-empty"><div class="empty-icon">&#127183;</div><p>' + msg + '</p></div>';
}

// ══════════════════════════════════════════
// Init
// ══════════════════════════════════════════
init();
</script>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebApplication","name":"Mana Base Calculator","url":"https://scrollvault.net/tools/manabase/","applicationCategory":"UtilitiesApplication","description":"Calculate the optimal mana base for your Magic: The Gathering deck using hypergeometric probability and Frank Karsten's proven math.","isPartOf":{"@type":"WebSite","name":"ScrollVault","url":"https://scrollvault.net"}}
</script>
</body>
</html>
